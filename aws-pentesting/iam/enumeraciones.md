# Enumeraciones

{% hint style="warning" %}
Los siguientes comandos dependen de permisos del servicio IAM
{% endhint %}

## Enumeración de usuarios

Listado de todos los usuarios.

```bash
aws iam list-users
```

<figure><img src="../../.gitbook/assets/image (5) (1) (3).png" alt=""><figcaption></figcaption></figure>



Listado de todos los grupos de un usuario en específico.

```bash
aws iam list-groups-for-user --user-name <Usuario>
```

<figure><img src="../../.gitbook/assets/image (11) (1).png" alt=""><figcaption></figcaption></figure>



### Certificados

Información sobre las claves públicas SSH asociadas al usuario específico.

```bash
aws iam list-ssh-public-keys --user-name <Usuario>
```

<figure><img src="../../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>



Comando que devuelve información sobre una llave pública SSH específica asociada al usuario especificado.

{% code overflow="wrap" %}
```bash
aws iam get-ssh-public-key --user-name <Usuario> -- encoding PEM --ssh-public-key-id <ID-SSH-Key>
```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (12) (1).png" alt=""><figcaption></figcaption></figure>



Comando para ver información sobre los certificados de firma asociados con el usuarios especificado.

```
aws iam list-signing-certificates --user-name <User>
```

<figure><img src="../../.gitbook/assets/image (14) (1) (1).png" alt=""><figcaption></figcaption></figure>



### Dispositivos MFA

Listado de los dispositivos MFA(Multi-Factor Authentication) virtuales definidos en la cuenta de AWS

```
aws iam list-virtual-mfa-devices
```

<figure><img src="../../.gitbook/assets/image (18) (1) (1).png" alt=""><figcaption></figcaption></figure>



### Políticas del usuario

Listado de políticas adjuntas al usuario

```bash
aws iam list-attached-user-policies --user-name <User>
```

<figure><img src="../../.gitbook/assets/image (19) (1).png" alt=""><figcaption></figcaption></figure>



Listado de políticas en formato simple asociadas al usuario // Políticas en línea insertadas (embed to one user)&#x20;

```bash
aws iam list-user-policies --user-name <User>
```

<figure><img src="../../.gitbook/assets/image (8) (2).png" alt=""><figcaption></figcaption></figure>



## Enumeración de grupos

Enumera todos los grupos

```bash
aws iam list-groups
```

<figure><img src="../../.gitbook/assets/image (15) (1).png" alt=""><figcaption></figcaption></figure>



### Políticas del grupo



Listado de todas las políticas asociadas a un grupo en específico

```
aws iam list-attached-group-policies --group-name <Group>
```

<figure><img src="../../.gitbook/assets/image (17) (1).png" alt=""><figcaption></figcaption></figure>



Listado de políticas en formato simple asociadas al grupo // Políticas en línea insertadas (embed to one group)&#x20;

```
aws iam list-group-policies --group-name <Group>
```

<figure><img src="../../.gitbook/assets/image (8) (1) (2).png" alt=""><figcaption></figcaption></figure>



## Enumeración de Roles

Listado de todos los roles de IAM

```bash
aws iam list-roles
```

<figure><img src="../../.gitbook/assets/image (4) (2).png" alt=""><figcaption></figcaption></figure>



Comando que devuelve información sobre el rol específico

```bash
aws iam get-role --role-name <Rol>
```

<figure><img src="../../.gitbook/assets/image (20) (1).png" alt=""><figcaption></figcaption></figure>



### Políticas del rol

Lista todas las políticas gestionadas que se adjuntan al rol

```bash
aws iam list-attached-role-policies --role-name <Rol>
```

<figure><img src="../../.gitbook/assets/image (10) (1).png" alt=""><figcaption></figcaption></figure>





Listado de políticas en formato simple asociadas al rol// Políticas en línea insertadas (embed to one rol)&#x20;

```
aws iam list-role-policies --role-name <Rol>
```

<figure><img src="../../.gitbook/assets/image (21) (1).png" alt=""><figcaption></figcaption></figure>



## Enumeración de políticas

Lista todas las políticas

```
aws iam list-policies
```

<figure><img src="../../.gitbook/assets/image (6) (1).png" alt=""><figcaption></figcaption></figure>



Información específica de una política

```
aws iam get-policy --policy-arn <ARN-Policy>
```

<figure><img src="../../.gitbook/assets/image (41).png" alt=""><figcaption></figcaption></figure>



### Versiones de políticas

Versión de la política

```bash
aws iam list-policy-versions --policy-arn <ARN-Policy>
```

<figure><img src="../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>



Información detallada de la versión de política

{% code overflow="wrap" %}
```bash
aws iam get-policy-version --policy-arn <ARN-Policy> --version-id <VersionID>
```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (9) (1).png" alt=""><figcaption></figcaption></figure>



## Herramientas Automatizadas

### Enumerate-iam.py

Por Andres Riancho

{% embed url="https://github.com/andresriancho/enumerate-iam" %}

{% code title="Instalación" overflow="wrap" %}
```bash
git clone git@github.com:andresriancho/enumerate-iam.git
cd enumerate-iam/
pip install -r requirements.txt
```
{% endcode %}

{% code title="Ejecución" overflow="wrap" %}
```bash
python3 enumerate-iam.py --access-key <A-Key> --secret-key <S-Key> [--session-token <sessionToken>] [--region <region>]
```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (4) (1) (2).png" alt=""><figcaption></figcaption></figure>

##

### cliam

Herramienta de enumeración de permisos de IAM en Golang

{% embed url="https://github.com/securisec/cliam" %}

{% code title="Instalación" overflow="wrap" %}
```bash
git clone https://github.com/securisec/cliam
cd cliam/cli
make dev
```
{% endcode %}

{% code title="Ejecución" overflow="wrap" %}
```bash
./cliam [aws | azure] [subcomand] [service] {[--profile name] | --access-key-id <A-key> --secret-access-key <S-Key>}
```
{% endcode %}

<figure><img src="../../.gitbook/assets/image (2) (1) (2).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (7) (1) (2).png" alt=""><figcaption></figcaption></figure>



### IAMFinder

Script en python para la enumeración

{% embed url="https://github.com/prisma-cloud/IAMFinder" %}

{% code title="Instalación" overflow="wrap" %}
```
git clone https://github.com/prisma-cloud/IAMFinder.git
cd IAMFinder
pip3 install -r requirements.txt
```
{% endcode %}

Luego configurar el archivo creds.json

{% code title="creds.json" overflow="wrap" %}
```json
{
    "account1": {
        "Region": "us-west-1",
        "Active": true,
        "AccessKeyId": "",
        "SecretAccessKey": ""
    },
    "account2": {
        "Region": "us-east-1",
        "Active": false,
        "AccessKeyId": "",
        "SecretAccessKey": ""
    }
}
```
{% endcode %}

{% code title="Ejecución 1" overflow="wrap" %}
```bash
python3 iamfinder.py init
```
{% endcode %}

{% code title="Ejecución 2" overflow="wrap" %}
```bash
python3 iamfinder.py [enum_user | enum_role |...] --aws_id number
```
{% endcode %}









