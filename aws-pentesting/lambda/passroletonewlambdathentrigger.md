# PassRoleToNewLambdaThenTrigger

## Laboratorio

En este apartado se observará el ejemplo utilizando el laboratorio IAM vulnerable con el escenario privesc16

{% embed url="https://bishopfox.com/blog/privilege-escalation-in-aws" %}
Lab: IAM - Vulnerable | Escenario: privesc16
{% endembed %}

Un atacante con los permisos <mark style="color:green;">**iam:PassRole**</mark> , <mark style="color:green;">**lambda:CreateFunction**</mark> y <mark style="color:green;">**lambda:CreateEventSourceMapping**</mark> (y posiblemente dynamodb:PutItem y dynamodb:CreateTable), pero ~~sin el permiso _lambda:InvokeFunction_~~, puede escalar privilegios creando una nueva función de Lambda y conectándola a una tabla de DynamoDB. Posteriormente, cuando se inserta una nueva fila en la tabla, la función Lambda ejecuta un código que aumenta los privilegios del usuario.

### Configuración Inicial

Usuario del laboratorio: privesc16-PassRoleToNewLambdaThenTriggerWithNewDynamo-user con las políticas:

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

La cuenta de AWS debe contener un rol existente que incluya los permisos:

* iam:AttachUserPolicy
* dynamodb:GetRecords&#x20;
* dynamodb:GetShardIterator
* dynamodb:DescribeStream
* dynamodb:ListStreams

y las funciones de Lambda deben tener permitido asumir este rol.&#x20;

La cuenta de AWS también necesita tener una tabla DynamoDB habilitada para transmisión.&#x20;

Alternativamente, si no existe una tabla DynamoDB, este método de escalada de privilegios aún puede funcionar si el atacante tiene el permiso dynamodb:CreateTable.

Posterior mente generar llaves e acceso desde cuenta administrador para interactuar con el usuario en AWS CLI y configurar un perfil para el usuario privesc16-PassRoleToNewLambdaThenTriggerWithNewDynamo-user



### Explotación

To do





